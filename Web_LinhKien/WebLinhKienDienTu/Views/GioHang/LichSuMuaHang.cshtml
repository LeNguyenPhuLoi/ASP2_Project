@using Microsoft.AspNetCore.Identity
@using WebLinhKienDienTu.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Home Page";
}

@model List<WebLinhKienDienTu.Models.Hoadon>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Shop Homepage - Start Bootstrap Template</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <style>
        .pagination {
            display: flex;
            justify-content: center; /* Căn giữa theo chiều ngang */
            align-items: center;
        }

    </style>

</head>

<body>
    @if (SignInManager.IsSignedIn(User) && User.IsInRole("User") && Model != null)
    {
        <div class="container mt-4">
            <div class="card shadow-lg">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Lịch sử mua hàng</h4>
                    <a class="btn btn-light btn-sm" asp-controller="GioHang" asp-action="GioHang" asp-route-email="@User.Identity.Name">← Quay lại</a>
            </div>

            <div class="card-body">
                <!-- Bộ lọc -->
                <form class="row mb-3" method="post" asp-action="LichSuMuaHang" asp-controller="GioHang">
                    <div class="col-md-3">
                        <input type="text" name="searchMa" class="form-control" placeholder="Tìm theo mã hóa đơn..." value="@ViewBag.searchMa">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="searchTrangThai" value="@ViewBag.searchTrangThai">
                            <option value="">-- Trạng thái --</option>
                            <option>Đã thanh toán</option>
                            <option>Chưa thanh toán</option>
                            <option>Đã hủy</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex gap-2">
                            <input type="date" name="searchNgay" class="form-control" value="@ViewBag.searchNgay">
                        </div>
                    </div>
                        <input type="hidden" name="email" value="@User.Identity.Name" />
                    <div class="col-md-2 text-end">
                        <button class="btn btn-success" type="submit">Lọc</button>
                        <a class="btn btn-secondary" href="@Url.Action("LichSuMuaHang", "GioHang", new { email = User.Identity.Name })">Làm mới</a>
                    </div>
                </form>

                <!-- Bảng danh sách hóa đơn -->
                <table class="table table-bordered text-center align-middle">
                    <thead class="table-secondary">
                        <tr>
                            <th>Mã hóa đơn</th>
                            <th>Ngày mua</th>
                            <th>Tổng tiền (₫)</th>
                            <th>Trạng thái</th>
                            <th width="20%">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                            @foreach(var item in Model)
                            {
                                <tr>
                                    <td>@item.Mahd</td>
                                    <td>@item.Ngaylap.Value.ToShortDateString()</td>
                                    <td>@item.Tongtien</td>
                                    @if (@item.Trangthai == "Đã thanh toán")
                                    {
                                        <td><span class="badge bg-success">Đã thanh toán</span></td>
                                    }
                                    else
                                    {
                                        <td><span class="badge bg-danger">Đã thanh toán</span></td>
                                    }
                                    
                                    <td>
                                        <a asp-controller="GioHang" asp-action="ChiTietHoaDon" asp-route-mahd="@item.Mahd" class="btn btn-info btn-sm">Chi tiết</a>
                                    </td>
                                </tr>
                            }
                    </tbody>
                </table>

                    <nav>
                        <ul class="pagination justify-content-center">

                            @if (ViewBag.Page > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("LichSuMuaHang", new { page = ViewBag.Page - 1 })">Previous</a>
                                </li>
                            }

                            @for (int i = 1; i <= ViewBag.TotalPage; i++)
                            {
                                <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("LichSuMuaHang", new { page = i })">@i</a>
                                </li>
                            }

                            @if (ViewBag.Page < ViewBag.TotalPage)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("LichSuMuaHang", new { page = ViewBag.Page + 1 })">Next</a>
                                </li>
                            }

                        </ul>
                    </nav>

                <!-- Nếu không có đơn
                <div class="text-center text-muted mt-3">
                    Bạn chưa có đơn hàng nào.
                </div> -->

            </div>
            </div>
        </div>
    }
</body>

</html>